{% extends 'base.html' %}
{% load crispy_forms_tags %}

{% block title %}Loan Application Details - QuickLoan{% endblock %}

{% block content %}
<div class="loan-details-container">
    <!-- Header Section -->
    <div class="application-header">
        <div class="header-content">
            <div class="header-main">
                <div class="header-icon">
                    <i class="fas fa-file-invoice-dollar"></i>
                </div>
                <div class="header-text">
                    <h1 class="page-title">Loan Application Details</h1>
                    <p class="page-subtitle">Application #{{ loan_application.id }} - {{ loan_application.loan_type.name }}</p>
                </div>
            </div>
            <div class="header-actions">
                <a href="{% url 'application_history' %}" class="btn btn-secondary">
                    <i class="fas fa-arrow-left me-2"></i>Back to Applications
                </a>
                <a href="{% url 'dashboard' %}" class="btn btn-outline">
                    <i class="fas fa-tachometer-alt me-2"></i>Dashboard
                </a>
            </div>
        </div>
    </div>

    <div class="application-content">
        <!-- Main Content -->
        <div class="application-main">
            <!-- Application Overview Cards -->
            <div class="overview-grid">
                <div class="dashboard-card">
                    <div class="card-header">
                        <div class="card-title-content">
                            <i class="fas fa-info-circle card-title-icon"></i>
                            <h3 class="card-title-text">Application Information</h3>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="info-grid">
                            <div class="info-item">
                                <span class="info-label">Loan Type</span>
                                <span class="info-value">{{ loan_application.loan_type.name }}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Amount</span>
                                <span class="info-value amount">KSh {{ loan_application.amount|floatformat:2 }}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Term</span>
                                <span class="info-value">{{ loan_application.term_months }} months</span>
                            </div>
                            <div class="info-item full-width">
                                <span class="info-label">Purpose</span>
                                <span class="info-value">{{ loan_application.purpose }}</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="dashboard-card">
                    <div class="card-header">
                        <div class="card-title-content">
                            <i class="fas fa-calendar-alt card-title-icon"></i>
                            <h3 class="card-title-text">Status & Timeline</h3>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="status-display">
                            <div class="status-badge status-{{ loan_application.status }}">
                                <i class="fas 
                                    {% if loan_application.status == 'approved' %}fa-check-circle
                                    {% elif loan_application.status == 'rejected' %}fa-times-circle
                                    {% elif loan_application.status == 'pending' %}fa-clock
                                    {% elif loan_application.status == 'under_review' %}fa-search
                                    {% elif loan_application.status == 'more_info' %}fa-info-circle
                                    {% else %}fa-question-circle{% endif %} status-icon">
                                </i>
                                {{ loan_application.get_status_display }}
                            </div>
                        </div>
                        <div class="timeline">
                            <div class="timeline-item">
                                <i class="fas fa-paper-plane timeline-icon"></i>
                                <div class="timeline-content">
                                    <span class="timeline-title">Application Submitted</span>
                                    <span class="timeline-date">{{ loan_application.application_date|date:"M d, Y H:i" }}</span>
                                </div>
                            </div>
                            {% if loan_application.approved_date %}
                            <div class="timeline-item">
                                <i class="fas fa-check-circle timeline-icon approved"></i>
                                <div class="timeline-content">
                                    <span class="timeline-title">Application Approved</span>
                                    <span class="timeline-date">{{ loan_application.approved_date|date:"M d, Y H:i" }}</span>
                                </div>
                            </div>
                            {% endif %}
                        </div>
                        {% if loan_application.rejection_reason %}
                        <div class="rejection-reason">
                            <i class="fas fa-exclamation-triangle"></i>
                            <div class="rejection-content">
                                <strong>Rejection Reason:</strong>
                                <span>{{ loan_application.rejection_reason }}</span>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Repayment Information for Approved Loans -->
            {% if loan_application.status == 'approved' %}
            <div class="dashboard-card">
                <div class="card-header">
                    <div class="card-title-content">
                        <i class="fas fa-chart-line card-title-icon"></i>
                        <h3 class="card-title-text">Repayment Information</h3>
                    </div>
                </div>
                <div class="card-body">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon monthly">
                                <i class="fas fa-calendar-check"></i>
                            </div>
                            <div class="stat-content">
                                <span class="stat-label">Monthly Installment</span>
                                <span class="stat-value">KSh {{ loan_application.monthly_installment|floatformat:2 }}</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon total">
                                <i class="fas fa-receipt"></i>
                            </div>
                            <div class="stat-content">
                                <span class="stat-label">Total Repayment</span>
                                <span class="stat-value">KSh {{ loan_application.total_repayment|floatformat:2 }}</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon interest">
                                <i class="fas fa-percentage"></i>
                            </div>
                            <div class="stat-content">
                                <span class="stat-label">Interest Rate</span>
                                <span class="stat-value">{{ loan_application.loan_type.interest_rate }}%</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon balance">
                                <i class="fas fa-balance-scale"></i>
                            </div>
                            <div class="stat-content">
                                <span class="stat-label">Remaining Balance</span>
                                <span class="stat-value">KSh {{ remaining_balance|floatformat:2 }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Withdrawal Information -->
            {% if withdrawal %}
            <div class="dashboard-card">
                <div class="card-header">
                    <div class="card-title-content">
                        <i class="fas fa-money-bill-wave card-title-icon"></i>
                        <h3 class="card-title-text">Withdrawal Information</h3>
                    </div>
                </div>
                <div class="card-body">
                    <div class="withdrawal-grid">
                        <div class="withdrawal-item">
                            <div class="withdrawal-icon">
                                <i class="fas fa-mobile-alt"></i>
                            </div>
                            <div class="withdrawal-content">
                                <span class="withdrawal-label">M-Pesa Number</span>
                                <span class="withdrawal-value">{{ withdrawal.mpesa_number }}</span>
                            </div>
                        </div>
                        <div class="withdrawal-item">
                            <div class="withdrawal-icon">
                                <i class="fas fa-money-bill"></i>
                            </div>
                            <div class="withdrawal-content">
                                <span class="withdrawal-label">Amount Sent</span>
                                <span class="withdrawal-value">KSh {{ withdrawal.amount|floatformat:2 }}</span>
                            </div>
                        </div>
                        <div class="withdrawal-item">
                            <div class="withdrawal-icon">
                                <i class="fas fa-receipt"></i>
                            </div>
                            <div class="withdrawal-content">
                                <span class="withdrawal-label">Transaction ID</span>
                                <span class="withdrawal-value code">{{ withdrawal.transaction_id }}</span>
                            </div>
                        </div>
                        <div class="withdrawal-item">
                            <div class="withdrawal-icon">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <div class="withdrawal-content">
                                <span class="withdrawal-label">Status</span>
                                <span class="withdrawal-status status-completed">{{ withdrawal.get_status_display }}</span>
                            </div>
                        </div>
                    </div>
                    <div class="withdrawal-timeline">
                        <div class="timeline-item">
                            <i class="fas fa-clock"></i>
                            <span>Withdrawal Date: {{ withdrawal.withdrawal_date|date:"M d, Y H:i" }}</span>
                        </div>
                        {% if withdrawal.processed_date %}
                        <div class="timeline-item">
                            <i class="fas fa-check"></i>
                            <span>Processed: {{ withdrawal.processed_date|date:"M d, Y H:i" }}</span>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endif %}
            {% endif %}

            <!-- Documents Section -->
            <div class="dashboard-card">
                <div class="card-header">
                    <div class="card-title-content">
                        <i class="fas fa-file-alt card-title-icon"></i>
                        <h3 class="card-title-text">Required Documents</h3>
                        <span class="documents-count">{{ documents.count }}/3 uploaded</span>
                    </div>
                </div>
                <div class="card-body">
                    <!-- Document Requirements -->
                    <div class="info-alert">
                        <i class="fas fa-info-circle alert-icon"></i>
                        <div class="alert-content">
                            <h4>Document Requirements</h4>
                            <p>Please upload the following documents to complete your application:</p>
                            <ul>
                                <li><strong>National ID Front:</strong> Clear photo of the front side of your National ID</li>
                                <li><strong>National ID Back:</strong> Clear photo of the back side of your National ID</li>
                                <li><strong>Passport Photo:</strong> Recent passport-sized photograph</li>
                            </ul>
                        </div>
                    </div>
                    
                    <!-- Upload Document Form -->
                    {% if loan_application.status == 'pending' or loan_application.status == 'more_info' %}
                    <div class="upload-section">
                        <div class="upload-header">
                            <i class="fas fa-upload"></i>
                            <h4>Upload Required Documents</h4>
                        </div>
                        <form method="post" enctype="multipart/form-data" class="upload-form">
                            {% csrf_token %}
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">Document Type</label>
                                    {{ document_form.document_type }}
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Document File</label>
                                    {{ document_form.document_file }}
                                </div>
                            </div>
                            <div class="upload-info">
                                <i class="fas fa-exclamation-triangle"></i>
                                <span><strong>File Requirements:</strong> Maximum file size: 5MB. Allowed formats: JPG, JPEG, PNG, PDF.</span>
                            </div>
                            <button type="submit" name="upload_document" class="btn btn-primary btn-upload">
                                <i class="fas fa-upload me-2"></i>Upload Document
                            </button>
                        </form>
                    </div>
                    {% endif %}

                    <!-- Document Progress -->
                    <div class="progress-section">
                        <div class="progress-header">
                            <h4>Document Checklist</h4>
                        </div>
                        <div class="checklist-grid">
                            {% for doc_type, doc_name in document_types %}
                            <div class="checklist-item {% if doc_type in uploaded_doc_types %}completed{% endif %}">
                                <div class="checklist-icon">
                                    {% if doc_type in uploaded_doc_types %}
                                    <i class="fas fa-check-circle"></i>
                                    {% else %}
                                    <i class="fas fa-times-circle"></i>
                                    {% endif %}
                                </div>
                                <div class="checklist-content">
                                    <strong>{{ doc_name }}</strong>
                                    <span>
                                        {% if doc_type == 'id_front' %}Front side of National ID
                                        {% elif doc_type == 'id_back' %}Back side of National ID
                                        {% elif doc_type == 'passport' %}Recent passport photo
                                        {% endif %}
                                    </span>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        
                        <!-- Progress Bar -->
                        {% with total_docs=3 %}
                        {% with uploaded_docs=documents.count %}
                        {% widthratio uploaded_docs total_docs 100 as progress_percentage %}
                        <div class="progress-container">
                            <div class="progress-info">
                                <span>Document Completion Progress</span>
                                <span>{{ uploaded_docs }}/{{ total_docs }} uploaded</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: {{ progress_percentage }}%;"
                                     data-progress="{{ progress_percentage }}"></div>
                            </div>
                        </div>
                        {% endwith %}
                        {% endwith %}
                    </div>

                    <!-- Documents List -->
                    {% if documents %}
                    <div class="documents-list">
                        <div class="documents-header">
                            <h4>Uploaded Documents</h4>
                        </div>
                        <div class="documents-table">
                            {% for document in documents %}
                            <div class="document-item">
                                <div class="document-info">
                                    <div class="document-icon">
                                        {% if document.document_file.name|lower|slice:"-4:" == ".pdf" %}
                                        <i class="fas fa-file-pdf"></i>
                                        {% else %}
                                        <i class="fas fa-file-image"></i>
                                        {% endif %}
                                    </div>
                                    <div class="document-details">
                                        <strong>{{ document.get_document_type_display }}</strong>
                                        <span>{{ document.document_file.name|slice:"-25:" }}</span>
                                        <small>Uploaded: {{ document.uploaded_at|date:"M d, Y H:i" }}</small>
                                    </div>
                                </div>
                                <div class="document-status">
                                    {% if document.verified %}
                                    <span class="status-badge status-verified">
                                        <i class="fas fa-check"></i>Verified
                                    </span>
                                    {% else %}
                                    <span class="status-badge status-pending">
                                        <i class="fas fa-clock"></i>Pending
                                    </span>
                                    {% endif %}
                                </div>
                                <div class="document-actions">
                                    <button class="btn-action view-document" data-document-id="{{ document.id }}">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <a href="{{ document.document_file.url }}" download class="btn-action">
                                        <i class="fas fa-download"></i>
                                    </a>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% else %}
                    <div class="empty-state">
                        <i class="fas fa-folder-open"></i>
                        <h4>No Documents Uploaded</h4>
                        <p>Please upload all required documents to complete your application review.</p>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Quick Stats for Approved Loans -->
            {% if loan_application.status == 'approved' %}
            <div class="dashboard-card">
                <div class="card-header">
                    <div class="card-title-content">
                        <i class="fas fa-chart-bar card-title-icon"></i>
                        <h3 class="card-title-text">Loan Overview</h3>
                    </div>
                </div>
                <div class="card-body">
                    <div class="overview-stats">
                        <div class="overview-stat">
                            <div class="stat-icon total-paid">
                                <i class="fas fa-wallet"></i>
                            </div>
                            <div class="stat-content">
                                <span class="stat-label">Total Paid</span>
                                <span class="stat-value">KSh {{ total_paid|floatformat:2 }}</span>
                            </div>
                        </div>
                        <div class="overview-stat">
                            <div class="stat-icon remaining">
                                <i class="fas fa-scale-balanced"></i>
                            </div>
                            <div class="stat-content">
                                <span class="stat-label">Remaining Balance</span>
                                <span class="stat-value">KSh {{ remaining_balance|floatformat:2 }}</span>
                            </div>
                        </div>
                        <div class="overview-stat">
                            <div class="stat-icon next-payment">
                                <i class="fas fa-calendar-day"></i>
                            </div>
                            <div class="stat-content">
                                <span class="stat-label">Next Payment Due</span>
                                <span class="stat-value">
                                    {% if next_payment %}
                                        {{ next_payment.due_date|date:"M d, Y" }}
                                    {% else %}
                                        No pending payments
                                    {% endif %}
                                </span>
                            </div>
                        </div>
                        <div class="overview-stat">
                            <div class="stat-icon payments-made">
                                <i class="fas fa-receipt"></i>
                            </div>
                            <div class="stat-content">
                                <span class="stat-label">Payments Made</span>
                                <span class="stat-value">{{ completed_payments_count }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>

        <!-- Sidebar Actions -->
        <div class="application-sidebar">
            <!-- Quick Actions -->
            <div class="dashboard-card">
                <div class="card-header">
                    <div class="card-title-content">
                        <i class="fas fa-bolt card-title-icon"></i>
                        <h3 class="card-title-text">Quick Actions</h3>
                    </div>
                </div>
                <div class="card-body">
                    <div class="action-buttons">
                        {% if loan_application.status == 'approved' %}
                            {% if not withdrawal %}
                                <a href="{% url 'loan_withdraw' loan_application.id %}" class="btn btn-primary btn-action-full">
                                    <i class="fas fa-money-bill-wave me-2"></i> Withdraw Funds
                                </a>
                            {% else %}
                                <button class="btn btn-success btn-action-full" disabled>
                                    <i class="fas fa-check me-2"></i> Funds Withdrawn
                                </button>
                            {% endif %}
                            
                            <a href="{% url 'make_payment' loan_application.id %}" class="btn btn-secondary btn-action-full">
                                <i class="fas fa-credit-card me-2"></i> Make Payment
                            </a>
                            
                            <a href="{% url 'payment_history' loan_application.id %}" class="btn btn-outline btn-action-full">
                                <i class="fas fa-history me-2"></i> Payment History
                            </a>
                        {% endif %}
                        
                        {% if loan_application.status == 'pending' or loan_application.status == 'more_info' %}
                            <a href="{% url 'loan_apply' loan_application.loan_type.id %}" class="btn btn-warning btn-action-full">
                                <i class="fas fa-edit me-2"></i> Edit Application
                            </a>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Application Summary -->
            <div class="dashboard-card">
                <div class="card-header">
                    <div class="card-title-content">
                        <i class="fas fa-file-contract card-title-icon"></i>
                        <h3 class="card-title-text">Application Summary</h3>
                    </div>
                </div>
                <div class="card-body">
                    <div class="summary-items">
                        <div class="summary-item">
                            <span class="summary-label">Application ID</span>
                            <span class="summary-value">#{{ loan_application.id }}</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Loan Category</span>
                            <span class="summary-value">{{ loan_application.loan_type.get_category_display }}</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Interest Rate</span>
                            <span class="summary-value">{{ loan_application.loan_type.interest_rate }}%</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Documents</span>
                            <span class="summary-value">{{ documents.count }}/3 uploaded</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Support Card -->
            <div class="dashboard-card">
                <div class="card-header">
                    <div class="card-title-content">
                        <i class="fas fa-headset card-title-icon"></i>
                        <h3 class="card-title-text">Need Help?</h3>
                    </div>
                </div>
                <div class="card-body">
                    <div class="support-content">
                        <p>If you have any questions about your application, our support team is here to help.</p>
                        <div class="support-actions">
                            <button class="btn btn-outline btn-support">
                                <i class="fas fa-envelope me-2"></i> Contact Support
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
/* Bitget Theme Variables */
:root {
    --bg-primary: #0B0E11;
    --bg-secondary: #1E2026;
    --bg-tertiary: #2B2F36;
    --border-color: #474D57;
    --text-primary: #EAECEF;
    --text-secondary: #B7BDC6;
    --text-muted: #848E9C;
    --accent-green: #00C087;
    --accent-green-hover: #00A875;
    --accent-yellow: #F0B90B;
    --accent-red: #F6465D;
    --accent-blue: #0095FF;
    --accent-purple: #8B5CF6;
}

/* Reset and Base Styles */
* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

body {
    background: var(--bg-primary);
    color: var(--text-primary);
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    line-height: 1.6;
}

.loan-details-container {
    min-height: 100vh;
    background: var(--bg-primary);
    padding: 0;
}

/* Header Styles */
.application-header {
    background: var(--bg-secondary);
    border-bottom: 1px solid var(--border-color);
    padding: 24px 0;
    margin-bottom: 0;
}

.header-content {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 24px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 24px;
}

.header-main {
    display: flex;
    align-items: center;
    gap: 16px;
    flex: 1;
}

.header-icon {
    width: 56px;
    height: 56px;
    background: linear-gradient(135deg, var(--accent-green), var(--accent-blue));
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--bg-primary);
    font-size: 1.25rem;
    flex-shrink: 0;
}

.header-text {
    flex: 1;
}

.page-title {
    color: var(--text-primary);
    font-size: 1.75rem;
    font-weight: 700;
    margin: 0 0 4px 0;
    line-height: 1.2;
}

.page-subtitle {
    color: var(--text-muted);
    margin: 0;
    font-size: 0.9rem;
    font-weight: 400;
}

.header-actions {
    display: flex;
    gap: 12px;
    flex-shrink: 0;
}

/* Application Layout */
.application-content {
    max-width: 1200px;
    margin: 0 auto;
    padding: 32px 24px;
    display: grid;
    grid-template-columns: 1fr 380px;
    gap: 24px;
    align-items: start;
}

/* Dashboard Card */
.dashboard-card {
    background: var(--bg-secondary);
    border: 1px solid var(--border-color);
    border-radius: 16px;
    overflow: hidden;
    margin-bottom: 24px;
    transition: all 0.3s ease;
}

.dashboard-card:hover {
    border-color: var(--accent-green);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.card-header {
    padding: 20px 24px;
    border-bottom: 1px solid var(--border-color);
    background: var(--bg-tertiary);
}

.card-title-content {
    display: flex;
    align-items: center;
    gap: 12px;
}

.card-title-icon {
    color: var(--accent-green);
    font-size: 1rem;
    width: 20px;
    text-align: center;
}

.card-title-text {
    color: var(--text-primary);
    font-size: 1.1rem;
    font-weight: 600;
    margin: 0;
    flex: 1;
}

.documents-count {
    background: var(--accent-blue);
    color: var(--bg-primary);
    padding: 4px 8px;
    border-radius: 6px;
    font-size: 0.8rem;
    font-weight: 600;
}

.card-body {
    padding: 24px;
}

/* Overview Grid */
.overview-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 24px;
    margin-bottom: 24px;
}

/* Info Grid */
.info-grid {
    display: flex;
    flex-direction: column;
    gap: 16px;
}

.info-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 0;
    border-bottom: 1px solid var(--border-color);
}

.info-item:last-child {
    border-bottom: none;
}

.info-item.full-width {
    flex-direction: column;
    align-items: flex-start;
    gap: 8px;
}

.info-label {
    color: var(--text-secondary);
    font-size: 0.875rem;
    font-weight: 500;
}

.info-value {
    color: var(--text-primary);
    font-weight: 600;
}

.info-value.amount {
    color: var(--accent-green);
    font-size: 1.1rem;
}

/* Status Display */
.status-display {
    margin-bottom: 20px;
}

.status-badge {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 8px 16px;
    border-radius: 8px;
    font-weight: 600;
    font-size: 0.875rem;
}

.status-approved {
    background: rgba(0, 192, 135, 0.1);
    color: var(--accent-green);
    border: 1px solid rgba(0, 192, 135, 0.3);
}

.status-pending {
    background: rgba(240, 185, 11, 0.1);
    color: var(--accent-yellow);
    border: 1px solid rgba(240, 185, 11, 0.3);
}

.status-rejected {
    background: rgba(246, 70, 93, 0.1);
    color: var(--accent-red);
    border: 1px solid rgba(246, 70, 93, 0.3);
}

.status-under_review {
    background: rgba(0, 149, 255, 0.1);
    color: var(--accent-blue);
    border: 1px solid rgba(0, 149, 255, 0.3);
}

.status-more_info {
    background: rgba(139, 92, 246, 0.1);
    color: var(--accent-purple);
    border: 1px solid rgba(139, 92, 246, 0.3);
}

.status-verified {
    background: rgba(0, 192, 135, 0.1);
    color: var(--accent-green);
    border: 1px solid rgba(0, 192, 135, 0.3);
    padding: 4px 8px;
    border-radius: 6px;
    font-size: 0.75rem;
}

/* Timeline */
.timeline {
    display: flex;
    flex-direction: column;
    gap: 16px;
}

.timeline-item {
    display: flex;
    align-items: flex-start;
    gap: 12px;
}

.timeline-icon {
    width: 24px;
    height: 24px;
    background: var(--bg-tertiary);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--text-muted);
    font-size: 0.8rem;
    flex-shrink: 0;
    margin-top: 2px;
}

.timeline-icon.approved {
    background: var(--accent-green);
    color: var(--bg-primary);
}

.timeline-content {
    display: flex;
    flex-direction: column;
    gap: 2px;
}

.timeline-title {
    color: var(--text-primary);
    font-size: 0.875rem;
    font-weight: 500;
}

.timeline-date {
    color: var(--text-muted);
    font-size: 0.75rem;
}

/* Rejection Reason */
.rejection-reason {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    padding: 16px;
    background: rgba(246, 70, 93, 0.1);
    border: 1px solid rgba(246, 70, 93, 0.3);
    border-radius: 8px;
    margin-top: 16px;
}

.rejection-reason i {
    color: var(--accent-red);
    margin-top: 2px;
}

.rejection-content {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.rejection-content strong {
    color: var(--accent-red);
    font-size: 0.875rem;
}

.rejection-content span {
    color: var(--text-secondary);
    font-size: 0.875rem;
    line-height: 1.4;
}

/* Stats Grid */
.stats-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
}

.stat-card {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 20px;
    background: var(--bg-tertiary);
    border: 1px solid var(--border-color);
    border-radius: 12px;
    transition: all 0.3s ease;
}

.stat-card:hover {
    border-color: var(--accent-green);
    transform: translateY(-2px);
}

.stat-icon {
    width: 48px;
    height: 48px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.25rem;
    flex-shrink: 0;
}

.stat-icon.monthly {
    background: linear-gradient(135deg, var(--accent-green), var(--accent-blue));
    color: var(--bg-primary);
}

.stat-icon.total {
    background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
    color: var(--bg-primary);
}

.stat-icon.interest {
    background: linear-gradient(135deg, var(--accent-yellow), #F59E0B);
    color: var(--bg-primary);
}

.stat-icon.balance {
    background: linear-gradient(135deg, var(--accent-green), #10B981);
    color: var(--bg-primary);
}

.stat-content {
    display: flex;
    flex-direction: column;
    gap: 4px;
    flex: 1;
}

.stat-label {
    color: var(--text-secondary);
    font-size: 0.875rem;
    font-weight: 500;
}

.stat-value {
    color: var(--text-primary);
    font-size: 1.1rem;
    font-weight: 700;
}

/* Withdrawal Grid */
.withdrawal-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 20px;
}

.withdrawal-item {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 16px;
    background: var(--bg-tertiary);
    border: 1px solid var(--border-color);
    border-radius: 12px;
}

.withdrawal-icon {
    width: 40px;
    height: 40px;
    background: var(--accent-green);
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--bg-primary);
    font-size: 1rem;
    flex-shrink: 0;
}

.withdrawal-content {
    display: flex;
    flex-direction: column;
    gap: 4px;
    flex: 1;
}

.withdrawal-label {
    color: var(--text-secondary);
    font-size: 0.875rem;
    font-weight: 500;
}

.withdrawal-value {
    color: var(--text-primary);
    font-weight: 600;
}

.withdrawal-value.code {
    font-family: 'Courier New', monospace;
    font-size: 0.8rem;
    color: var(--accent-green);
}

.withdrawal-status {
    padding: 4px 8px;
    border-radius: 6px;
    font-size: 0.75rem;
    font-weight: 600;
}

.status-completed {
    background: rgba(0, 192, 135, 0.1);
    color: var(--accent-green);
    border: 1px solid rgba(0, 192, 135, 0.3);
}

.withdrawal-timeline {
    display: flex;
    gap: 20px;
    padding-top: 16px;
    border-top: 1px solid var(--border-color);
}

.withdrawal-timeline .timeline-item {
    display: flex;
    align-items: center;
    gap: 8px;
    color: var(--text-muted);
    font-size: 0.875rem;
}

.withdrawal-timeline .timeline-item i {
    color: var(--accent-green);
}

/* Info Alert */
.info-alert {
    display: flex;
    align-items: flex-start;
    gap: 16px;
    padding: 20px;
    background: rgba(0, 149, 255, 0.1);
    border: 1px solid rgba(0, 149, 255, 0.3);
    border-radius: 12px;
    margin-bottom: 24px;
}

.alert-icon {
    color: var(--accent-blue);
    font-size: 1.25rem;
    margin-top: 2px;
    flex-shrink: 0;
}

.alert-content {
    flex: 1;
}

.alert-content h4 {
    color: var(--accent-blue);
    font-size: 1rem;
    margin: 0 0 8px 0;
}

.alert-content p {
    color: var(--text-secondary);
    margin: 0 0 12px 0;
    font-size: 0.875rem;
}

.alert-content ul {
    color: var(--text-secondary);
    font-size: 0.875rem;
    padding-left: 16px;
    margin: 0;
}

.alert-content li {
    margin-bottom: 4px;
}

.alert-content li strong {
    color: var(--text-primary);
}

/* Upload Section */
.upload-section {
    border: 1px solid var(--border-color);
    border-radius: 12px;
    overflow: hidden;
    margin-bottom: 24px;
}

.upload-header {
    padding: 16px 20px;
    background: var(--bg-tertiary);
    border-bottom: 1px solid var(--border-color);
    display: flex;
    align-items: center;
    gap: 12px;
}

.upload-header i {
    color: var(--accent-green);
    font-size: 1.1rem;
}

.upload-header h4 {
    color: var(--text-primary);
    font-size: 1rem;
    margin: 0;
}

.upload-form {
    padding: 20px;
}

.form-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
    margin-bottom: 16px;
}

.form-group {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.form-label {
    color: var(--text-primary);
    font-weight: 600;
    font-size: 0.875rem;
}

/* Form Input Styling */
.upload-form select,
.upload-form input[type="file"] {
    background: var(--bg-tertiary);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    color: var(--text-primary);
    padding: 12px 16px;
    font-size: 0.875rem;
    transition: all 0.3s ease;
    width: 100%;
    font-family: inherit;
}

.upload-form select:focus,
.upload-form input[type="file"]:focus {
    outline: none;
    border-color: var(--accent-green);
    box-shadow: 0 0 0 3px rgba(0, 192, 135, 0.1);
}

/* Style the file input specifically */
.upload-form input[type="file"] {
    cursor: pointer;
}

.upload-form input[type="file"]::file-selector-button {
    background: var(--accent-green);
    color: var(--bg-primary);
    border: none;
    padding: 8px 16px;
    border-radius: 6px;
    margin-right: 12px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
}

.upload-form input[type="file"]::file-selector-button:hover {
    background: var(--accent-green-hover);
}

/* Style select dropdown */
.upload-form select {
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%23B7BDC6'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 12px center;
    background-size: 16px;
    padding-right: 40px;
}

.upload-info {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 12px 16px;
    background: rgba(240, 185, 11, 0.1);
    border: 1px solid rgba(240, 185, 11, 0.3);
    border-radius: 8px;
    margin-bottom: 16px;
    font-size: 0.875rem;
    color: var(--accent-yellow);
}

.upload-info i {
    flex-shrink: 0;
}

.btn-upload {
    width: 100%;
    padding: 14px;
    font-size: 0.9rem;
}

/* Progress Section */
.progress-section {
    margin-bottom: 24px;
}

.progress-header {
    margin-bottom: 16px;
}

.progress-header h4 {
    color: var(--text-primary);
    font-size: 1rem;
    margin: 0;
}

.checklist-grid {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: 12px;
    margin-bottom: 20px;
}

.checklist-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 16px;
    background: var(--bg-tertiary);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    transition: all 0.3s ease;
}

.checklist-item.completed {
    border-color: var(--accent-green);
    background: rgba(0, 192, 135, 0.05);
}

.checklist-icon {
    font-size: 1.25rem;
    flex-shrink: 0;
}

.checklist-item.completed .checklist-icon {
    color: var(--accent-green);
}

.checklist-item:not(.completed) .checklist-icon {
    color: var(--accent-red);
}

.checklist-content {
    display: flex;
    flex-direction: column;
    gap: 2px;
    flex: 1;
}

.checklist-content strong {
    color: var(--text-primary);
    font-size: 0.875rem;
}

.checklist-content span {
    color: var(--text-muted);
    font-size: 0.75rem;
}

.progress-container {
    margin-top: 16px;
}

.progress-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
}

.progress-info span {
    color: var(--text-secondary);
    font-size: 0.875rem;
    font-weight: 500;
}

.progress-bar {
    height: 8px;
    background: var(--bg-tertiary);
    border-radius: 4px;
    overflow: hidden;
}

.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--accent-green), var(--accent-blue));
    border-radius: 4px;
    transition: width 0.6s ease;
    position: relative;
}

.progress-fill::after {
    content: attr(data-progress) '%';
    position: absolute;
    right: 8px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--bg-primary);
    font-size: 0.7rem;
    font-weight: 600;
}

/* Documents List */
.documents-list {
    margin-top: 24px;
}

.documents-header {
    margin-bottom: 16px;
}

.documents-header h4 {
    color: var(--text-primary);
    font-size: 1rem;
    margin: 0;
}

.documents-table {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.document-item {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 16px;
    background: var(--bg-tertiary);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    transition: all 0.3s ease;
}

.document-item:hover {
    border-color: var(--accent-green);
    transform: translateY(-1px);
}

.document-info {
    display: flex;
    align-items: center;
    gap: 12px;
    flex: 1;
}

.document-icon {
    width: 40px;
    height: 40px;
    background: var(--bg-secondary);
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.1rem;
    flex-shrink: 0;
}

.document-icon .fa-file-pdf {
    color: var(--accent-red);
}

.document-icon .fa-file-image {
    color: var(--accent-blue);
}

.document-details {
    display: flex;
    flex-direction: column;
    gap: 2px;
    flex: 1;
}

.document-details strong {
    color: var(--text-primary);
    font-size: 0.875rem;
}

.document-details span {
    color: var(--text-secondary);
    font-size: 0.8rem;
}

.document-details small {
    color: var(--text-muted);
    font-size: 0.75rem;
}

.document-status {
    margin-right: 16px;
}

.document-actions {
    display: flex;
    gap: 8px;
}

.btn-action {
    width: 36px;
    height: 36px;
    background: var(--bg-secondary);
    border: 1px solid var(--border-color);
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--text-secondary);
    text-decoration: none;
    transition: all 0.3s ease;
}

.btn-action:hover {
    background: var(--accent-green);
    border-color: var(--accent-green);
    color: var(--bg-primary);
}

/* Empty State */
.empty-state {
    text-align: center;
    padding: 40px 20px;
}

.empty-state i {
    font-size: 3rem;
    color: var(--text-muted);
    margin-bottom: 16px;
}

.empty-state h4 {
    color: var(--text-primary);
    margin: 0 0 8px 0;
    font-size: 1.1rem;
}

.empty-state p {
    color: var(--text-muted);
    margin: 0;
    font-size: 0.9rem;
}

/* Overview Stats */
.overview-stats {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr 1fr;
    gap: 16px;
}

.overview-stat {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 16px;
    background: var(--bg-tertiary);
    border: 1px solid var(--border-color);
    border-radius: 8px;
}

.overview-stat .stat-icon {
    width: 40px;
    height: 40px;
    border-radius: 8px;
    font-size: 1rem;
}

.overview-stat .stat-icon.total-paid {
    background: var(--accent-green);
    color: var(--bg-primary);
}

.overview-stat .stat-icon.remaining {
    background: var(--accent-yellow);
    color: var(--bg-primary);
}

.overview-stat .stat-icon.next-payment {
    background: var(--accent-blue);
    color: var(--bg-primary);
}

.overview-stat .stat-icon.payments-made {
    background: var(--accent-purple);
    color: var(--bg-primary);
}

.overview-stat .stat-content {
    gap: 2px;
}

.overview-stat .stat-label {
    font-size: 0.8rem;
}

.overview-stat .stat-value {
    font-size: 0.9rem;
}

/* Action Buttons */
.action-buttons {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.btn-action-full {
    width: 100%;
    padding: 14px;
    text-align: center;
    justify-content: center;
    font-size: 0.9rem;
}

/* Summary Items */
.summary-items {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.summary-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 0;
    border-bottom: 1px solid var(--border-color);
}

.summary-item:last-child {
    border-bottom: none;
}

.summary-label {
    color: var(--text-secondary);
    font-size: 0.875rem;
}

.summary-value {
    color: var(--text-primary);
    font-weight: 600;
    font-size: 0.875rem;
}

/* Support Content */
.support-content p {
    color: var(--text-secondary);
    font-size: 0.875rem;
    margin-bottom: 16px;
    line-height: 1.5;
}

.support-actions {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.btn-support {
    width: 100%;
    padding: 12px;
    font-size: 0.875rem;
}

/* Button Styles */
.btn {
    border-radius: 8px;
    font-weight: 600;
    padding: 12px 20px;
    border: none;
    transition: all 0.3s ease;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-size: 0.875rem;
    cursor: pointer;
    font-family: inherit;
}

.btn-primary {
    background: linear-gradient(135deg, var(--accent-green), var(--accent-green-hover));
    color: var(--bg-primary);
}

.btn-primary:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0, 192, 135, 0.3);
}

.btn-secondary {
    background: var(--accent-blue);
    color: var(--bg-primary);
}

.btn-secondary:hover {
    background: var(--accent-blue);
    opacity: 0.9;
    transform: translateY(-2px);
}

.btn-warning {
    background: var(--accent-yellow);
    color: var(--bg-primary);
}

.btn-warning:hover {
    background: var(--accent-yellow);
    opacity: 0.9;
    transform: translateY(-2px);
}

.btn-success {
    background: var(--accent-green);
    color: var(--bg-primary);
}

.btn-success:hover:not(:disabled) {
    background: var(--accent-green);
    opacity: 0.9;
}

.btn-outline {
    background: transparent;
    color: var(--text-primary);
    border: 1px solid var(--border-color);
}

.btn-outline:hover {
    background: var(--border-color);
    border-color: var(--text-muted);
}

.btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none !important;
}

/* Crispy Forms Fix */
.form-group {
    margin-bottom: 1rem;
}

.form-control {
    background: var(--bg-tertiary) !important;
    border: 1px solid var(--border-color) !important;
    color: var(--text-primary) !important;
    border-radius: 8px !important;
}

.form-control:focus {
    border-color: var(--accent-green) !important;
    box-shadow: 0 0 0 3px rgba(0, 192, 135, 0.1) !important;
}

/* Responsive Design */
@media (max-width: 1024px) {
    .application-content {
        grid-template-columns: 1fr;
        gap: 20px;
    }
    
    .overview-grid {
        grid-template-columns: 1fr;
    }
    
    .stats-grid {
        grid-template-columns: 1fr;
    }
    
    .withdrawal-grid {
        grid-template-columns: 1fr;
    }
    
    .checklist-grid {
        grid-template-columns: 1fr;
    }
    
    .overview-stats {
        grid-template-columns: 1fr 1fr;
    }
}

@media (max-width: 768px) {
    .application-header {
        padding: 20px 0;
    }
    
    .header-content {
        padding: 0 20px;
        flex-direction: column;
        align-items: flex-start;
        gap: 16px;
    }
    
    .header-main {
        width: 100%;
    }
    
    .header-actions {
        width: 100%;
        justify-content: center;
    }
    
    .application-content {
        padding: 24px 20px;
    }
    
    .form-grid {
        grid-template-columns: 1fr;
        gap: 16px;
    }
    
    .page-title {
        font-size: 1.5rem;
    }
    
    .header-icon {
        width: 48px;
        height: 48px;
        font-size: 1.1rem;
    }
}

@media (max-width: 480px) {
    .application-header {
        padding: 16px 0;
    }
    
    .header-content {
        padding: 0 16px;
    }
    
    .application-content {
        padding: 20px 16px;
    }
    
    .card-body {
        padding: 20px;
    }
    
    .overview-stats {
        grid-template-columns: 1fr;
    }
    
    .document-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
    }
    
    .document-status {
        margin-right: 0;
        align-self: flex-start;
    }
    
    .document-actions {
        align-self: flex-end;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Add loading states to buttons
    const forms = document.querySelectorAll('form');
    forms.forEach(form => {
        form.addEventListener('submit', function() {
            const submitBtn = this.querySelector('button[type="submit"]');
            if (submitBtn) {
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Processing...';
                submitBtn.disabled = true;
            }
        });
    });

    // Add animation to progress bars
    const progressBars = document.querySelectorAll('.progress-fill');
    progressBars.forEach(bar => {
        const width = bar.style.width;
        bar.style.width = '0%';
        setTimeout(() => {
            bar.style.width = width;
        }, 300);
    });

    // Add hover effects to cards
    const cards = document.querySelectorAll('.dashboard-card');
    cards.forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-4px)';
        });
        
        card.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
        });
    });

    // Document view functionality
    const viewButtons = document.querySelectorAll('.view-document');
    viewButtons.forEach(button => {
        button.addEventListener('click', function() {
            const documentId = this.getAttribute('data-document-id');
            // Here you would typically open a modal or new window to view the document
            // For now, we'll just download the document
            const downloadUrl = this.closest('.document-item').querySelector('a[download]').href;
            window.open(downloadUrl, '_blank');
        });
    });

    // Support button functionality
    const supportBtn = document.querySelector('.btn-support');
    if (supportBtn) {
        supportBtn.addEventListener('click', function() {
            alert('Support feature coming soon! In the meantime, please email support@quickloan.com');
        });
    }

    // Add smooth scrolling for better UX
    const smoothScroll = (target) => {
        const element = document.querySelector(target);
        if (element) {
            element.scrollIntoView({
                behavior: 'smooth',
                block: 'start'
            });
        }
    };

    // Add click handlers for any anchor links that should smooth scroll
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            smoothScroll(this.getAttribute('href'));
        });
    });
});
</script>
{% endblock %}